<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pymatgen.core.tests.test_structure &#8212; pymatgen 4.5.3 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/proBlue.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '4.5.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="top" title="pymatgen 4.5.3 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33990148-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 4.5.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.core.tests.test_structure</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf-8</span>
<span class="c1"># Copyright (c) Pymatgen Development Team.</span>
<span class="c1"># Distributed under the terms of the MIT License.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">unicode_literals</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">from</span> <span class="nn">pymatgen.util.testing</span> <span class="k">import</span> <span class="n">PymatgenTest</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.periodic_table</span> <span class="k">import</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Specie</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.composition</span> <span class="k">import</span> <span class="n">Composition</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.operations</span> <span class="k">import</span> <span class="n">SymmOp</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="k">import</span> <span class="n">IStructure</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">IMolecule</span><span class="p">,</span> \
    <span class="n">StructureError</span><span class="p">,</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.lattice</span> <span class="k">import</span> <span class="n">Lattice</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<div class="viewcode-block" id="IStructureTest"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest">[docs]</a><span class="k">class</span> <span class="nc">IStructureTest</span><span class="p">(</span><span class="n">PymatgenTest</span><span class="p">):</span>

<div class="viewcode-block" id="IStructureTest.setUp"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">([[</span><span class="mf">3.8401979337</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">],</span>
                                <span class="p">[</span><span class="mf">1.9200989668</span><span class="p">,</span> <span class="mf">3.3257101909</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">],</span>
                                <span class="p">[</span><span class="mf">0.00</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2171384943</span><span class="p">,</span> <span class="mf">3.1355090603</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">struct</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="s2">&quot;Wrong number of sites in structure!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">is_ordered</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">ntypesp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0000001</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">StructureError</span><span class="p">,</span> <span class="n">IStructure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span>
                          <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propertied_structure</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span>
            <span class="n">site_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;magmom&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">]})</span></div>

<div class="viewcode-block" id="IStructureTest.test_matches"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_matches">[docs]</a>    <span class="k">def</span> <span class="nf">test_matches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">))</span></div>

<div class="viewcode-block" id="IStructureTest.test_bad_structure"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_bad_structure">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">StructureError</span><span class="p">,</span> <span class="n">IStructure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span>
                          <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">validate_proximity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#these shouldn&#39;t raise an error</span>
        <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="IStructureTest.test_volume_and_density"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_volume_and_density">[docs]</a>    <span class="k">def</span> <span class="nf">test_volume_and_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="mf">40.04</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Volume wrong!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">density</span><span class="p">,</span> <span class="mf">2.33</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                               <span class="s2">&quot;Incorrect density&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_specie_init"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_specie_init">[docs]</a>    <span class="k">def</span> <span class="nf">test_specie_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[{</span><span class="n">Specie</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span> <span class="mf">1.0</span><span class="p">},</span>
                                      <span class="p">{</span><span class="n">Specie</span><span class="p">(</span><span class="s1">&#39;Mg&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mf">0.8</span><span class="p">}],</span> <span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s1">&#39;Mg0.8 O1&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_get_sorted_structure"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_get_sorted_structure">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_sorted_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">],</span> <span class="n">coords</span><span class="p">,</span>
                       <span class="n">site_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;charge&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>
        <span class="n">sorted_s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_sorted_structure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sorted_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">species_and_occu</span><span class="p">,</span> <span class="n">Composition</span><span class="p">(</span><span class="s2">&quot;Li&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sorted_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">species_and_occu</span><span class="p">,</span> <span class="n">Composition</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sorted_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sorted_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Se&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;Se&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">],</span>
                       <span class="p">[[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span>
                          <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_sorted_structure</span><span class="p">()],</span>
                         <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;Se&quot;</span><span class="p">,</span> <span class="s2">&quot;Se&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="IStructureTest.test_get_space_group_data"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_get_space_group_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_space_group_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">get_space_group_info</span><span class="p">(),</span> <span class="p">(</span><span class="s1">&#39;Fd-3m&#39;</span><span class="p">,</span> <span class="mi">227</span><span class="p">))</span></div>

<div class="viewcode-block" id="IStructureTest.test_fractional_occupations"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_fractional_occupations">[docs]</a>    <span class="k">def</span> <span class="nf">test_fractional_occupations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">}],</span>
                       <span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s1">&#39;Mg0.8 O1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">is_ordered</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_get_distance"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_get_distance">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">get_distance</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">2.35</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                               <span class="s2">&quot;Distance calculated wrongly!&quot;</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">distance_from_point</span><span class="p">(</span><span class="n">pt</span><span class="p">),</span>
                               <span class="mf">1.50332963784</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                               <span class="s2">&quot;Distance calculated wrongly!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_as_dict"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">test_as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">si</span> <span class="o">=</span> <span class="n">Specie</span><span class="p">(</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">mn</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Mn&quot;</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[{</span><span class="n">si</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">mn</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span> <span class="p">{</span><span class="n">si</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}],</span>
                            <span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;lattice&quot;</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">as_dict</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;sites&quot;</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">as_dict</span><span class="p">())</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertied_structure</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;magmom&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[{</span><span class="n">Specie</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
                                              <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;spin&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}):</span> <span class="mf">1.0</span><span class="p">},</span>
                                      <span class="p">{</span><span class="n">Specie</span><span class="p">(</span><span class="s1">&#39;Mg&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                              <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;spin&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}):</span> <span class="mf">0.8</span><span class="p">}],</span>
                       <span class="n">coords</span><span class="p">,</span> <span class="n">site_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;magmom&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">]})</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;magmom&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;species&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;spin&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;lattice&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="IStructureTest.test_from_dict"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">test_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertied_structure</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">IStructure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertied_structure</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">IStructure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lattice&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">3.8401979337</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="mf">40.044794644251596</span><span class="p">,</span>
                         <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mf">3.8401979337177736</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">3.840198994344244</span><span class="p">,</span>
                         <span class="s1">&#39;matrix&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">3.8401979337</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mf">1.9200989668</span><span class="p">,</span> <span class="mf">3.3257101909</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2171384943</span><span class="p">,</span> <span class="mf">3.1355090603</span><span class="p">]],</span>
                         <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">119.9999908639842</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mf">90.0</span><span class="p">,</span>
                         <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">60.000009137322195</span><span class="p">},</span>
             <span class="s1">&#39;sites&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;magmom&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="s1">&#39;abc&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                        <span class="s1">&#39;occu&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;species&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;occu&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                                                  <span class="s1">&#39;oxidation_state&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
                                                  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;spin&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
                                                  <span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">}],</span>
                        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O2-&#39;</span><span class="p">,</span> <span class="s1">&#39;xyz&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]},</span>
                       <span class="p">{</span><span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;magmom&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">},</span>
                        <span class="s1">&#39;abc&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span>
                        <span class="s1">&#39;occu&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;species&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;occu&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
                                                  <span class="s1">&#39;oxidation_state&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                                                  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;spin&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
                                                  <span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="s1">&#39;Mg&#39;</span><span class="p">}],</span>
                        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Mg2+:0.800&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;xyz&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.8401979336749994</span><span class="p">,</span> <span class="mf">1.2247250003039056e-06</span><span class="p">,</span>
                                <span class="mf">2.351631795225</span><span class="p">]}]}</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">IStructure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">spin</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">IStructure</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_site_properties"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_site_properties">[docs]</a>    <span class="k">def</span> <span class="nf">test_site_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">site_props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertied_structure</span><span class="o">.</span><span class="n">site_properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">site_props</span><span class="p">[</span><span class="s1">&#39;magmom&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propertied_structure</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propertied_structure</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_copy"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_copy">[docs]</a>    <span class="k">def</span> <span class="nf">test_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propertied_structure</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">site_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;charge&#39;</span><span class="p">:</span>
                                                                     <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_struct</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_struct</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_struct</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_struct</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0000001</span><span class="p">])</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span><span class="p">],</span> <span class="n">coords</span><span class="p">,</span>
                               <span class="n">site_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;magmom&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">]})</span>

        <span class="n">new_struct</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">site_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;charge&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]},</span>
                                    <span class="n">sanitize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_struct</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_struct</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_struct</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_struct</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">new_struct</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="n">structure</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_interpolate"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_interpolate">[docs]</a>    <span class="k">def</span> <span class="nf">test_interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">coords2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="n">struct2</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords2</span><span class="p">)</span>
        <span class="n">int_s</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">struct2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">int_s</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;Interpolation Failed!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">int_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">lattice</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayEqual</span><span class="p">(</span><span class="n">int_s</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.725</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.725</span><span class="p">])</span>

        <span class="n">badlattice</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.00</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">struct2</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="n">badlattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">interpolate</span><span class="p">,</span> <span class="n">struct2</span><span class="p">)</span>

        <span class="n">coords2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="n">struct2</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span> <span class="s2">&quot;Fe&quot;</span><span class="p">],</span> <span class="n">coords2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">interpolate</span><span class="p">,</span> <span class="n">struct2</span><span class="p">)</span>

        <span class="c1"># Test autosort feature.</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="s2">&quot;Fm-3m&quot;</span><span class="p">,</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                                       <span class="p">[</span><span class="s2">&quot;Fe&quot;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="n">s1</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="s2">&quot;Fm-3m&quot;</span><span class="p">,</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                                       <span class="p">[</span><span class="s2">&quot;Fe&quot;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="n">s2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s1</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="n">autosort_tol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>

        <span class="c1"># Make sure autosort has no effect on simpler interpolations,</span>
        <span class="c1"># and with shuffled sites.</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="s2">&quot;Fm-3m&quot;</span><span class="p">,</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                                       <span class="p">[</span><span class="s2">&quot;Fe&quot;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="s2">&quot;Fm-3m&quot;</span><span class="p">,</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                                       <span class="p">[</span><span class="s2">&quot;Fe&quot;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Fe&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s1</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="n">autosort_tol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_interpolate_lattice"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_interpolate_lattice">[docs]</a>    <span class="k">def</span> <span class="nf">test_interpolate_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">coords2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_lengths_and_angles</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">70</span><span class="p">])</span>
        <span class="n">struct2</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords2</span><span class="p">)</span>
        <span class="n">int_s</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">struct2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">interpolate_lattices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">,</span>
                                    <span class="n">int_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span>
                                    <span class="n">int_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">struct2</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">,</span>
                                    <span class="n">int_s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">struct2</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span>
                                    <span class="n">int_s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
        <span class="n">int_angles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">110.3976469</span><span class="p">,</span> <span class="mf">94.5359731</span><span class="p">,</span> <span class="mf">64.5165856</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">int_angles</span><span class="p">,</span>
                                    <span class="n">int_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>

        <span class="c1"># Assert that volume is monotonic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">struct2</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">volume</span> <span class="o">&gt;=</span> <span class="n">int_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">int_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">volume</span> <span class="o">&gt;=</span> <span class="n">struct</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_interpolate_lattice_rotation"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_interpolate_lattice_rotation">[docs]</a>    <span class="k">def</span> <span class="nf">test_interpolate_lattice_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.01</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.01</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">]]</span>
        <span class="n">struct1</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">struct2</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">int_s</span> <span class="o">=</span> <span class="n">struct1</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">struct2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">interpolate_lattices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert that volume is monotonic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">struct2</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">volume</span> <span class="o">&gt;=</span> <span class="n">int_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">int_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">volume</span> <span class="o">&gt;=</span> <span class="n">struct1</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_get_primitive_structure"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_get_primitive_structure">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_primitive_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]]</span>
        <span class="n">fcc_ag</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mf">4.09</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Ag&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fcc_ag</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]]</span>
        <span class="n">bcc_li</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mf">4.09</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Li&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">bcc_prim</span> <span class="o">=</span> <span class="n">bcc_li</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bcc_prim</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">bcc_prim</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="mf">109.47122</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.26</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mf">4.09</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Ag&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">()),</span> <span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_primitive_cell_site_merging"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_primitive_cell_site_merging">[docs]</a>    <span class="k">def</span> <span class="nf">test_primitive_cell_site_merging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.74</span><span class="p">]]</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ag&#39;</span><span class="p">,</span> <span class="s1">&#39;Ag&#39;</span><span class="p">,</span> <span class="s1">&#39;Be&#39;</span><span class="p">,</span> <span class="s1">&#39;Be&#39;</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">dm</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">()</span><span class="o">.</span><span class="n">distance_matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span></div>

<div class="viewcode-block" id="IStructureTest.test_primitive_on_large_supercell"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_primitive_on_large_supercell">[docs]</a>    <span class="k">def</span> <span class="nf">test_primitive_on_large_supercell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]]</span>
        <span class="n">fcc_ag</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mf">4.09</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Ag&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">fcc_ag</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">fcc_ag_prim</span> <span class="o">=</span> <span class="n">fcc_ag</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fcc_ag_prim</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">fcc_ag_prim</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="mf">17.10448225</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_primitive_positions"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_primitive_positions">[docs]</a>    <span class="k">def</span> <span class="nf">test_primitive_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">]]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">Lattice</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">88</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Ag&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">sc_matrix</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span><span class="p">]:</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">sc</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">(</span><span class="n">sc_matrix</span><span class="p">)</span>
            <span class="n">prim</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prim</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">prim</span><span class="o">.</span><span class="n">distance_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.0203432356739286</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_primitive_structure_volume_check"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_primitive_structure_volume_check">[docs]</a>    <span class="k">def</span> <span class="nf">test_primitive_structure_volume_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">tetragonal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.333</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.333</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.666</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.666</span><span class="p">]]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">IStructure</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Ag&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">sprim</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sprim</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_get_all_neighbors_and_get_neighbors"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_get_all_neighbors_and_get_neighbors">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_all_neighbors_and_get_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_neighbors_in_shell</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                                       <span class="n">include_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="mi">47</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nn</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">all_nn</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_all_neighbors</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_nn</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">r</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">site</span><span class="p">,</span> <span class="n">nns</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">all_nn</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">nns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">nn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_periodic_image</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">nn</span><span class="p">[</span><span class="mi">2</span><span class="p">]]))</span>
                <span class="n">d</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">site</span><span class="o">.</span><span class="n">coords</span> <span class="o">-</span> <span class="n">nn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nn</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;Li&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">s</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">get_all_neighbors</span><span class="p">(</span><span class="mi">3</span><span class="p">))),</span> <span class="mi">976</span><span class="p">)</span></div>


<div class="viewcode-block" id="IStructureTest.test_get_all_neighbors_outside_cell"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_get_all_neighbors_outside_cell">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_all_neighbors_outside_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;Li&#39;</span><span class="p">,</span> <span class="s1">&#39;Li&#39;</span><span class="p">,</span> <span class="s1">&#39;Li&#39;</span><span class="p">,</span> <span class="s1">&#39;Si&#39;</span><span class="p">],</span>
                      <span class="p">[[</span><span class="mf">3.1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.11</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.91</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">all_nn</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_all_neighbors</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">site</span><span class="p">,</span> <span class="n">nns</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">all_nn</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">nns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">nn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_periodic_image</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">nn</span><span class="p">[</span><span class="mi">2</span><span class="p">]]))</span>
                <span class="n">d</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">site</span><span class="o">.</span><span class="n">coords</span> <span class="o">-</span> <span class="n">nn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nn</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">all_nn</span><span class="p">)),</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="IStructureTest.test_get_dist_matrix"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_get_dist_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_dist_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.3516318</span><span class="p">],</span>
               <span class="p">[</span><span class="mf">2.3516318</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">distance_matrix</span><span class="p">,</span> <span class="n">ans</span><span class="p">)</span></div>

<div class="viewcode-block" id="IStructureTest.test_to_from_file_string"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IStructureTest.test_to_from_file_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_to_from_file_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cif&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;poscar&quot;</span><span class="p">,</span> <span class="s2">&quot;cssr&quot;</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="n">IStructure</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span>
                <span class="n">ss</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">lengths_and_angles</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">lengths_and_angles</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">IStructure</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;POSCAR.testing&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;POSCAR.testing&quot;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;POSCAR.testing&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;Si_testing.yaml&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;Si_testing.yaml&quot;</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;Si_testing.yaml&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Si_testing.yaml&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;POSCAR.testing.gz&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;POSCAR.testing.gz&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;POSCAR.testing.gz&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="StructureTest"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest">[docs]</a><span class="k">class</span> <span class="nc">StructureTest</span><span class="p">(</span><span class="n">PymatgenTest</span><span class="p">):</span>

<div class="viewcode-block" id="StructureTest.setUp"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">([[</span><span class="mf">3.8401979337</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">],</span>
                           <span class="p">[</span><span class="mf">1.9200989668</span><span class="p">,</span> <span class="mf">3.3257101909</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">],</span>
                           <span class="p">[</span><span class="mf">0.00</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2171384943</span><span class="p">,</span> <span class="mf">3.1355090603</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span><span class="p">],</span> <span class="n">coords</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_mutable_sequence_methods"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_mutable_sequence_methods">[docs]</a>    <span class="k">def</span> <span class="nf">test_mutable_sequence_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Fe&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Fe1 Si1&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Fe&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Fe1 Si1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="n">s</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">specie</span><span class="p">,</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Si&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Mn&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Mn0.5 Fe1&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Mn0.5&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Fe&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;magmom&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Fe1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_non_hash"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_non_hash">[docs]</a>    <span class="k">def</span> <span class="nf">test_non_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span></div>

<div class="viewcode-block" id="StructureTest.test_sort"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_sort">[docs]</a>    <span class="k">def</span> <span class="nf">test_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
        <span class="n">s</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">species_string</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">species_string</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">site</span><span class="p">:</span> <span class="n">site</span><span class="o">.</span><span class="n">species_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">species_string</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">species_string</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">site</span><span class="p">:</span> <span class="n">site</span><span class="o">.</span><span class="n">species_string</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">species_string</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">species_string</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_append_insert_remove_replace"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_append_insert_remove_replace">[docs]</a>    <span class="k">def</span> <span class="nf">test_append_insert_remove_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">s</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si2 O1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ntypesp</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">symbol_set</span> <span class="o">==</span> <span class="p">(</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">indices_from_symbol</span><span class="p">(</span><span class="s2">&quot;Si&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">indices_from_symbol</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
        <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si1 O1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">indices_from_symbol</span><span class="p">(</span><span class="s2">&quot;Si&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">indices_from_symbol</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si1 N1 O1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ntypesp</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">symbol_set</span> <span class="o">==</span> <span class="p">(</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">indices_from_symbol</span><span class="p">(</span><span class="s2">&quot;Si&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">indices_from_symbol</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">indices_from_symbol</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ge&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Ge1 N1 O1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">symbol_set</span> <span class="o">==</span> <span class="p">(</span><span class="s2">&quot;Ge&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">))</span>
        <span class="n">s</span><span class="o">.</span><span class="n">replace_species</span><span class="p">({</span><span class="s2">&quot;Ge&quot;</span><span class="p">:</span> <span class="s2">&quot;Si&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si1 N1 O1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ntypesp</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">s</span><span class="o">.</span><span class="n">replace_species</span><span class="p">({</span><span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Ge&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si0.5 Ge0.5 N1 O1&quot;</span><span class="p">)</span>
        <span class="c1">#this should change the .5Si .5Ge sites to .75Si .25Ge</span>
        <span class="n">s</span><span class="o">.</span><span class="n">replace_species</span><span class="p">({</span><span class="s2">&quot;Ge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Ge&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si0.75 Ge0.25 N1 O1&quot;</span><span class="p">)</span>

        <span class="c1"># In this case, s.ntypesp is ambiguous.</span>
        <span class="c1"># for the time being, we raise AttributeError.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
            <span class="n">s</span><span class="o">.</span><span class="n">ntypesp</span>

        <span class="n">s</span><span class="o">.</span><span class="n">remove_species</span><span class="p">([</span><span class="s2">&quot;Si&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Ge0.25 N1 O1&quot;</span><span class="p">)</span>

        <span class="n">s</span><span class="o">.</span><span class="n">remove_sites</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Ge0.25&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_add_site_property"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_add_site_property">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_site_property</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">s</span><span class="o">.</span><span class="n">add_site_property</span><span class="p">(</span><span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">4.1</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">add_site_property</span><span class="p">(</span><span class="s2">&quot;magmom&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_propertied_structure"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_propertied_structure">[docs]</a>    <span class="k">def</span> <span class="nf">test_propertied_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Make sure that site properties are set to None for missing values.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">s</span><span class="o">.</span><span class="n">add_site_property</span><span class="p">(</span><span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">4.1</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span> <span class="p">,</span><span class="mf">0.3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">site_properties</span><span class="p">[</span><span class="s2">&quot;charge&quot;</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_perturb"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_perturb">[docs]</a>    <span class="k">def</span> <span class="nf">test_perturb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">pre_perturbation_sites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">perturb</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
        <span class="n">post_perturbation_sites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pre_perturbation_sites</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">post_perturbation_sites</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">d</span><span class="p">,</span>
                                   <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Bad perturbation distance&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_add_oxidation_states"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_add_oxidation_states">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_oxidation_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">oxidation_states</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">add_oxidation_state_by_element</span><span class="p">(</span><span class="n">oxidation_states</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">site</span><span class="o">.</span><span class="n">species_and_occu</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">oxi_state</span><span class="p">,</span> <span class="n">oxidation_states</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">symbol</span><span class="p">],</span>
                                 <span class="s2">&quot;Wrong oxidation state assigned!&quot;</span><span class="p">)</span>
        <span class="n">oxidation_states</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Fe&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">add_oxidation_state_by_element</span><span class="p">,</span>
                          <span class="n">oxidation_states</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">add_oxidation_state_by_site</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">oxi_state</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">add_oxidation_state_by_site</span><span class="p">,</span>
                          <span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="StructureTest.test_remove_oxidation_states"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_remove_oxidation_states">[docs]</a>    <span class="k">def</span> <span class="nf">test_remove_oxidation_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">co_elem</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Co&quot;</span><span class="p">)</span>
        <span class="n">o_elem</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)</span>
        <span class="n">co_specie</span> <span class="o">=</span> <span class="n">Specie</span><span class="p">(</span><span class="s2">&quot;Co&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">o_specie</span> <span class="o">=</span> <span class="n">Specie</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">s_elem</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="n">co_elem</span><span class="p">,</span> <span class="n">o_elem</span><span class="p">],</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">s_specie</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="p">[</span><span class="n">co_specie</span><span class="p">,</span> <span class="n">o_specie</span><span class="p">],</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">s_specie</span><span class="o">.</span><span class="n">remove_oxidation_states</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s_elem</span><span class="p">,</span> <span class="n">s_specie</span><span class="p">,</span> <span class="s2">&quot;Oxidation state remover &quot;</span>
                                           <span class="s2">&quot;failed&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_apply_operation"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_apply_operation">[docs]</a>    <span class="k">def</span> <span class="nf">test_apply_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">SymmOp</span><span class="o">.</span><span class="n">from_axis_angle_and_translation</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">apply_operation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span>
            <span class="p">[[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">3.840198</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">],</span>
             <span class="p">[</span><span class="o">-</span><span class="mf">3.325710</span><span class="p">,</span> <span class="mf">1.920099</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">],</span>
             <span class="p">[</span><span class="mf">2.217138</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">3.135509</span><span class="p">]],</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">op</span> <span class="o">=</span> <span class="n">SymmOp</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">apply_operation</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">fractional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span>
            <span class="p">[[</span><span class="mf">5.760297</span><span class="p">,</span> <span class="mf">3.325710</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">],</span>
             <span class="p">[</span><span class="mf">3.840198</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">],</span>
             <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.217138</span><span class="p">,</span> <span class="mf">3.135509</span><span class="p">]],</span> <span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_apply_strain"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_apply_strain">[docs]</a>    <span class="k">def</span> <span class="nf">test_apply_strain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">initial_coord</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span>
        <span class="n">s</span><span class="o">.</span><span class="n">apply_strain</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">3.8785999130369997</span><span class="p">,</span> <span class="mf">3.878600984287687</span><span class="p">,</span> <span class="mf">3.8785999130549516</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">initial_coord</span> <span class="o">*</span> <span class="mf">1.01</span><span class="p">)</span>
        <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span>
        <span class="n">s</span><span class="o">.</span><span class="n">apply_strain</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
        <span class="n">a2</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">b2</span> <span class="o">/</span> <span class="n">b1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">c2</span> <span class="o">/</span> <span class="n">c1</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_scale_lattice"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_scale_lattice">[docs]</a>    <span class="k">def</span> <span class="nf">test_scale_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">initial_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">scale_lattice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">volume</span> <span class="o">*</span> <span class="mf">1.01</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">3.8785999130369997</span><span class="p">,</span> <span class="mf">3.878600984287687</span><span class="p">,</span> <span class="mf">3.8785999130549516</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span>
            <span class="n">initial_coord</span> <span class="o">*</span> <span class="mf">1.01</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_translate_sites"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_translate_sites">[docs]</a>    <span class="k">def</span> <span class="nf">test_translate_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">translate_sites</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                       <span class="n">frac_coords</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">translate_sites</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                       <span class="n">frac_coords</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">cart_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mf">3.38014845</span><span class="p">,</span> <span class="mf">1.05428585</span><span class="p">,</span> <span class="mf">2.06775453</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">translate_sites</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                       <span class="n">frac_coords</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">to_unit_cell</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mf">1.00187517</span><span class="p">,</span> <span class="mf">1.25665291</span><span class="p">,</span> <span class="mf">1.15946374</span><span class="p">])</span></div>

<div class="viewcode-block" id="StructureTest.test_mul"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_mul">[docs]</a>    <span class="k">def</span> <span class="nf">test_mul</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">*=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si4&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Structure</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">*</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">,</span>
                                    <span class="p">[</span><span class="mf">7.6803959</span><span class="p">,</span> <span class="mf">17.5979979</span><span class="p">,</span> <span class="mf">7.6803959</span><span class="p">])</span></div>

<div class="viewcode-block" id="StructureTest.test_make_supercell"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_make_supercell">[docs]</a>    <span class="k">def</span> <span class="nf">test_make_supercell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si4&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si4&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si32&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">,</span>
                                    <span class="p">[</span><span class="mf">15.360792</span><span class="p">,</span> <span class="mf">35.195996</span><span class="p">,</span> <span class="mf">7.680396</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_disordered_supercell_primitive_cell"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_disordered_supercell_primitive_cell">[docs]</a>    <span class="k">def</span> <span class="nf">test_disordered_supercell_primitive_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]]</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;Si&#39;</span><span class="p">:</span> <span class="mf">0.54738</span><span class="p">}]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="c1">#this supercell often breaks things</span>
        <span class="n">s</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_another_supercell"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_another_supercell">[docs]</a>    <span class="k">def</span> <span class="nf">test_another_supercell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#this is included b/c for some reason the old algo was failing on it</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si32&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si4&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_to_from_dict"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_to_from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">test_to_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">s2</span><span class="p">),</span> <span class="n">Structure</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_to_from_file_string"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_to_from_file_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_to_from_file_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cif&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;poscar&quot;</span><span class="p">,</span> <span class="s2">&quot;cssr&quot;</span><span class="p">,</span> <span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;xsf&quot;</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span>
                <span class="n">ss</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">lengths_and_angles</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">lengths_and_angles</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">Structure</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;POSCAR.testing&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;POSCAR.testing&quot;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;POSCAR.testing&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;structure_testing.json&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;structure_testing.json&quot;</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;structure_testing.json&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;structure_testing.json&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_from_spacegroup"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_from_spacegroup">[docs]</a>    <span class="k">def</span> <span class="nf">test_from_spacegroup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="s2">&quot;Fm-3m&quot;</span><span class="p">,</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">],</span>
                                       <span class="p">[[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Li8 O4&quot;</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">],</span>
                                       <span class="p">[[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>

        <span class="n">s2</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">],</span>
                                       <span class="p">[[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                                       <span class="n">site_properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;charge&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">site_properties</span><span class="p">[</span><span class="s2">&quot;charge&quot;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="s2">&quot;Pm-3m&quot;</span><span class="p">,</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Cs&quot;</span><span class="p">,</span> <span class="s2">&quot;Cl&quot;</span><span class="p">],</span>
                                      <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Cs1 Cl1&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">,</span>
                          <span class="s2">&quot;Pm-3m&quot;</span><span class="p">,</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">tetragonal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Cs&quot;</span><span class="p">,</span> <span class="s2">&quot;Cl&quot;</span><span class="p">],</span>
                          <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">,</span>
                          <span class="s2">&quot;Pm-3m&quot;</span><span class="p">,</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Cs&quot;</span><span class="p">],</span>
                          <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span></div>

<div class="viewcode-block" id="StructureTest.test_merge_sites"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_merge_sites">[docs]</a>    <span class="k">def</span> <span class="nf">test_merge_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">species</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;Ag&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;Cl&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;Cl&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span>
                   <span class="p">{</span><span class="s1">&#39;Ag&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.501</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.501</span><span class="p">]]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">species</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">merge_sites</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="s1">&#39;Ag&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">species_and_occu</span><span class="p">,</span>
                         <span class="n">Composition</span><span class="p">({</span><span class="s1">&#39;Cl&#39;</span><span class="p">:</span> <span class="mf">0.35</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="p">[</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5005</span><span class="p">])</span>

        <span class="c1"># Test for TaS2 with spacegroup 166 in 160 setting.</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_lengths_and_angles</span><span class="p">([</span><span class="mf">3.374351</span><span class="p">,</span> <span class="mf">3.374351</span><span class="p">,</span> <span class="mf">20.308941</span><span class="p">],</span>
                                            <span class="p">[</span><span class="mf">90.000000</span><span class="p">,</span> <span class="mf">90.000000</span><span class="p">,</span> <span class="mf">120.000000</span><span class="p">])</span>
        <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Ta&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.944333</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.333333</span><span class="p">,</span> <span class="mf">0.666667</span><span class="p">,</span> <span class="mf">0.353424</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.666667</span><span class="p">,</span> <span class="mf">0.333333</span><span class="p">,</span> <span class="mf">0.535243</span><span class="p">]]</span>
        <span class="n">tas2</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tas2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">13</span>
        <span class="n">tas2</span><span class="o">.</span><span class="n">merge_sites</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tas2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">9</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_lengths_and_angles</span><span class="p">([</span><span class="mf">3.587776</span><span class="p">,</span> <span class="mf">3.587776</span><span class="p">,</span> <span class="mf">19.622793</span><span class="p">],</span>
                                            <span class="p">[</span><span class="mf">90.000000</span><span class="p">,</span> <span class="mf">90.000000</span><span class="p">,</span> <span class="mf">120.000000</span><span class="p">])</span>
        <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Na&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.333333</span><span class="p">,</span> <span class="mf">0.666667</span><span class="p">,</span> <span class="mf">0.165000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.998333</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.333333</span><span class="p">,</span> <span class="mf">0.666667</span><span class="p">,</span> <span class="mf">0.399394</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.666667</span><span class="p">,</span> <span class="mf">0.333333</span><span class="p">,</span> <span class="mf">0.597273</span><span class="p">]]</span>
        <span class="n">navs2</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">navs2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">18</span>
        <span class="n">navs2</span><span class="o">.</span><span class="n">merge_sites</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">navs2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span></div>

<div class="viewcode-block" id="StructureTest.test_properties"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_properties">[docs]</a>    <span class="k">def</span> <span class="nf">test_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">num_sites</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>
        <span class="n">sites</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">group_by_types</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sites</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">add_oxidation_state_by_element</span><span class="p">({</span><span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mi">62</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_set_item"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_set_item">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si1 C1&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;Ge&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Ge2&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Sn&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Sn2&quot;</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s</span><span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;C2&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;C0.25Si0.5&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si1 C0.5&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;C0.25Si0.5&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si1.25 C0.125&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_init_error"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_init_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_init_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">StructureError</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span></div>

<div class="viewcode-block" id="StructureTest.test_from_sites"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_from_sites">[docs]</a>    <span class="k">def</span> <span class="nf">test_from_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">add_site_property</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_sites</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span> <span class="n">to_unit_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">site_properties</span><span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTest.test_magic"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.StructureTest.test_magic">[docs]</a>    <span class="k">def</span> <span class="nf">test_magic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_sites</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">apply_strain</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="IMoleculeTest"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest">[docs]</a><span class="k">class</span> <span class="nc">IMoleculeTest</span><span class="p">(</span><span class="n">PymatgenTest</span><span class="p">):</span>

<div class="viewcode-block" id="IMoleculeTest.setUp"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">1.089000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">1.026719</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">0.513360</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.889165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">0.513360</span><span class="p">,</span> <span class="mf">0.889165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">([</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="n">coords</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_set_item"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_set_item">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Si&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si1 H4&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;Ge&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Ge2 H3&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Sn&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Sn2 H3&quot;</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s</span><span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;C1 F4&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;C0.25Si0.5&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si0.5 C0.25 F4&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;C0.25Si0.5&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si0.625 C0.0625 F4&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_bad_molecule"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_bad_molecule">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">1.089000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">1.026719</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">0.513360</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.889165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">0.513360</span><span class="p">,</span> <span class="mf">0.889165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">0.513360</span><span class="p">,</span> <span class="mf">0.889165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.36301</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">StructureError</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">,</span>
                          <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="n">coords</span><span class="p">,</span>
                          <span class="n">validate_proximity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_get_angle_dihedral"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_get_angle_dihedral">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_angle_dihedral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_angle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mf">109.47122144618737</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_angle</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mf">60.00001388659683</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                               <span class="o">-</span> <span class="mf">35.26438851071765</span><span class="p">)</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol2</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">([</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">],</span> <span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol2</span><span class="o">.</span><span class="n">get_dihedral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="o">-</span><span class="mi">90</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_get_covalent_bonds"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_get_covalent_bonds">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_covalent_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_covalent_bonds</span><span class="p">()),</span> <span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_properties"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_properties">[docs]</a>    <span class="k">def</span> <span class="nf">test_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">is_ordered</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H4 C1&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_repr_str"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_repr_str">[docs]</a>    <span class="k">def</span> <span class="nf">test_repr_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Full Formula (H4 C1)</span>
<span class="s2">Reduced Formula: H4C</span>
<span class="s2">Charge = 0, Spin Mult = 1</span>
<span class="s2">Sites (5)</span>
<span class="s2">0 C     0.000000     0.000000     0.000000</span>
<span class="s2">1 H     0.000000     0.000000     1.089000</span>
<span class="s2">2 H     1.026719     0.000000    -0.363000</span>
<span class="s2">3 H    -0.513360    -0.889165    -0.363000</span>
<span class="s2">4 H    -0.513360     0.889165    -0.363000&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">__str__</span><span class="p">(),</span> <span class="n">ans</span><span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Molecule Summary</span>
<span class="s2">Site: C (0.0000, 0.0000, 0.0000)</span>
<span class="s2">Site: H (0.0000, 0.0000, 1.0890)</span>
<span class="s2">Site: H (1.0267, 0.0000, -0.3630)</span>
<span class="s2">Site: H (-0.5134, -0.8892, -0.3630)</span>
<span class="s2">Site: H (-0.5134, 0.8892, -0.3630)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">),</span> <span class="n">ans</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_site_properties"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_site_properties">[docs]</a>    <span class="k">def</span> <span class="nf">test_site_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">propertied_mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">([</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span>
                                  <span class="n">site_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;magmom&#39;</span><span class="p">:</span>
                                                   <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">propertied_mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">propertied_mol</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_get_boxed_structure"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_get_boxed_structure">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_boxed_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_boxed_structure</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
        <span class="c1"># C atom should be in center of box.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span>
                                    <span class="p">[</span><span class="mf">0.50000001</span><span class="p">,</span>  <span class="mf">0.5</span><span class="p">,</span>  <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span>
                                    <span class="p">[</span><span class="mf">0.6140799</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>  <span class="mf">0.45966667</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_boxed_structure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_boxed_structure</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">),</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

        <span class="c1"># Test offset option</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_boxed_structure</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s3</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span>
                                    <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
        <span class="c1"># Test no_cross option</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_boxed_structure</span><span class="p">,</span>
                          <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">no_cross</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_get_distance"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_get_distance">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_distance</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">1.089</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_get_neighbors"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_get_neighbors">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_get_neighbors_in_shell"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_get_neighbors_in_shell">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_neighbors_in_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_neighbors_in_shell</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_neighbors_in_shell</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_neighbors_in_shell</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_neighbors_in_shell</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_get_dist_matrix"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_get_dist_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_dist_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.089</span><span class="p">,</span> <span class="mf">1.08899995636</span><span class="p">,</span> <span class="mf">1.08900040717</span><span class="p">,</span> <span class="mf">1.08900040717</span><span class="p">],</span>
               <span class="p">[</span><span class="mf">1.089</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.77832952654</span><span class="p">,</span> <span class="mf">1.7783298026</span><span class="p">,</span> <span class="mf">1.7783298026</span><span class="p">],</span>
               <span class="p">[</span><span class="mf">1.08899995636</span><span class="p">,</span> <span class="mf">1.77832952654</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.77833003783</span><span class="p">,</span>
                <span class="mf">1.77833003783</span><span class="p">],</span>
               <span class="p">[</span><span class="mf">1.08900040717</span><span class="p">,</span> <span class="mf">1.7783298026</span><span class="p">,</span> <span class="mf">1.77833003783</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.77833</span><span class="p">],</span>
               <span class="p">[</span><span class="mf">1.08900040717</span><span class="p">,</span> <span class="mf">1.7783298026</span><span class="p">,</span> <span class="mf">1.77833003783</span><span class="p">,</span> <span class="mf">1.77833</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">distance_matrix</span><span class="p">,</span> <span class="n">ans</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_break_bond"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_break_bond">[docs]</a>    <span class="k">def</span> <span class="nf">test_break_bond</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">break_bond</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H3 C1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H1&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_prop"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_prop">[docs]</a>    <span class="k">def</span> <span class="nf">test_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">spin_multiplicity</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">nelectrons</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">spin_multiplicity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">([</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">spin_multiplicity</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nelectrons</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

        <span class="c1">#Triplet O2</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">IMolecule</span><span class="p">([</span><span class="s2">&quot;O&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">]],</span>
                        <span class="n">spin_multiplicity</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">spin_multiplicity</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_equal"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_equal">[docs]</a>    <span class="k">def</span> <span class="nf">test_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">IMolecule</span><span class="p">([</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_get_centered_molecule"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_get_centered_molecule">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_centered_molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">IMolecule</span><span class="p">([</span><span class="s2">&quot;O&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">]],</span>
                        <span class="n">spin_multiplicity</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">centered</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">get_centered_molecule</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">centered</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_to_from_dict"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_to_from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">test_to_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="n">mol2</span> <span class="o">=</span> <span class="n">IMolecule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">mol2</span><span class="p">),</span> <span class="n">IMolecule</span><span class="p">)</span>
        <span class="n">propertied_mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">([</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span>
                                  <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">site_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;magmom&#39;</span><span class="p">:</span>
                                                   <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">propertied_mol</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;magmom&#39;</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">propertied_mol</span><span class="p">,</span> <span class="n">mol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H4 C1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="IMoleculeTest.test_to_from_file_string"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.IMoleculeTest.test_to_from_file_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_to_from_file_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;g03&quot;</span><span class="p">,</span> <span class="s2">&quot;yaml&quot;</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">IMolecule</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">IMolecule</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;CH4_testing.xyz&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;CH4_testing.xyz&quot;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;CH4_testing.xyz&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;CH4_testing.yaml&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;CH4_testing.yaml&quot;</span><span class="p">))</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;CH4_testing.yaml&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">mol</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;CH4_testing.yaml&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MoleculeTest"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest">[docs]</a><span class="k">class</span> <span class="nc">MoleculeTest</span><span class="p">(</span><span class="n">PymatgenTest</span><span class="p">):</span>

<div class="viewcode-block" id="MoleculeTest.setUp"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">1.089000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">1.026719</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">0.513360</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.889165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">0.513360</span><span class="p">,</span> <span class="mf">0.889165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">([</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="n">coords</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTest.test_mutable_sequence_methods"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest.test_mutable_sequence_methods">[docs]</a>    <span class="k">def</span> <span class="nf">test_mutable_sequence_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H3 C1 F1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="n">s</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">specie</span><span class="p">,</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span>
                                    <span class="p">[</span><span class="o">-</span><span class="mf">0.513360</span><span class="p">,</span> <span class="mf">0.889165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H2 C1 F1&quot;</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;charge&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H2 N1 F1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTest.test_insert_remove_append"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest.test_insert_remove_append">[docs]</a>    <span class="k">def</span> <span class="nf">test_insert_remove_append</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H4 C1 O1&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">mol</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H3 C1 O1&quot;</span><span class="p">)</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">set_charge_and_spin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">spin_multiplicity</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H3 C1 N1 O1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="p">[(</span><span class="n">mol</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">remove_sites</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H3 N1&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTest.test_translate_sites"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest.test_translate_sites">[docs]</a>    <span class="k">def</span> <span class="nf">test_translate_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">translate_sites</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">cart_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span></div>

<div class="viewcode-block" id="MoleculeTest.test_rotate_sites"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest.test_rotate_sites">[docs]</a>    <span class="k">def</span> <span class="nf">test_rotate_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">rotate_sites</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">cart_coords</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                              <span class="p">[</span>  <span class="mf">0.889164737</span><span class="p">,</span>   <span class="mf">0.513359500</span><span class="p">,</span>  <span class="o">-</span><span class="mf">0.363000000</span><span class="p">])</span></div>

<div class="viewcode-block" id="MoleculeTest.test_replace"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest.test_replace">[docs]</a>    <span class="k">def</span> <span class="nf">test_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ge&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Ge1 H4&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">replace_species</span><span class="p">({</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Ge&quot;</span><span class="p">):</span> <span class="p">{</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Ge&quot;</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">,</span>
                                                  <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Si&quot;</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si0.5 Ge0.5 H4&quot;</span><span class="p">)</span>

        <span class="c1">#this should change the .5Si .5Ge sites to .75Si .25Ge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">replace_species</span><span class="p">({</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Ge&quot;</span><span class="p">):</span> <span class="p">{</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Ge&quot;</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">,</span>
                                                  <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Si&quot;</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;Si0.75 Ge0.25 H4&quot;</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">pre_perturbation_sites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">sites</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">perturb</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
        <span class="n">post_perturbation_sites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">sites</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pre_perturbation_sites</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">post_perturbation_sites</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">d</span><span class="p">,</span>
                                   <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Bad perturbation distance&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTest.test_add_site_property"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest.test_add_site_property">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_site_property</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">add_site_property</span><span class="p">(</span><span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">4.1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">add_site_property</span><span class="p">(</span><span class="s2">&quot;magmom&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTest.test_to_from_dict"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest.test_to_from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">test_to_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="n">mol2</span> <span class="o">=</span> <span class="n">Molecule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">mol2</span><span class="p">),</span> <span class="n">Molecule</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTest.test_apply_operation"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest.test_apply_operation">[docs]</a>    <span class="k">def</span> <span class="nf">test_apply_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">SymmOp</span><span class="o">.</span><span class="n">from_axis_angle_and_translation</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">90</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">apply_operation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertArrayAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span>
                                    <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">1.026719</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">])</span></div>

<div class="viewcode-block" id="MoleculeTest.test_substitute"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest.test_substitute">[docs]</a>    <span class="k">def</span> <span class="nf">test_substitute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">1.08</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">1.026719</span><span class="p">,</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">0.513360</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.889165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">0.513360</span><span class="p">,</span> <span class="mf">0.889165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.363000</span><span class="p">]]</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">([</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_distance</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mf">1.54</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">([</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.11</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_distance</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="mf">1.35</span><span class="p">)</span>
        <span class="n">oh</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">([</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span>
                      <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.780362</span><span class="p">,</span> <span class="o">-.</span><span class="mi">456316</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">114079</span><span class="p">],</span>
                       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-.</span><span class="mi">780362</span><span class="p">,</span> <span class="o">-.</span><span class="mi">456316</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">oh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_distance</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="mf">1.43</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;methyl&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H7 C3 O1 F1&quot;</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00000</span><span class="p">,</span> <span class="mf">1.40272</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.00000</span><span class="p">,</span> <span class="mf">2.49029</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">1.21479</span><span class="p">,</span> <span class="mf">0.70136</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">2.15666</span><span class="p">,</span> <span class="mf">1.24515</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">1.21479</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.70136</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">2.15666</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.24515</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.00000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.40272</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.00000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49029</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">1.21479</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.70136</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">2.15666</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.24515</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">1.21479</span><span class="p">,</span> <span class="mf">0.70136</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">2.15666</span><span class="p">,</span> <span class="mf">1.24515</span><span class="p">,</span> <span class="mf">0.00000</span><span class="p">]]</span>
        <span class="n">benzene</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">([</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">benzene</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">benzene</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;H8 C7&quot;</span><span class="p">)</span>
        <span class="c1">#Carbon attached should be in plane.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">benzene</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleculeTest.test_to_from_file_string"><a class="viewcode-back" href="../../../../pymatgen.core.tests.test_structure.html#pymatgen.core.tests.test_structure.MoleculeTest.test_to_from_file_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_to_from_file_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;g03&quot;</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">Molecule</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;CH4_testing.xyz&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;CH4_testing.xyz&quot;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;CH4_testing.xyz&quot;</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">unittest2</span> <span class="k">as</span> <span class="nn">unittest</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 4.5.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2011, Pymatgen Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>